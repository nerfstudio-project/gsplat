<!doctype html>
<html class="no-js" lang="en" data-content_root="../">
  <head><meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <meta name="color-scheme" content="light dark"><meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="index" title="Index" href="../genindex.html" /><link rel="search" title="Search" href="../search.html" /><link rel="next" title="Utils" href="utils.html" /><link rel="prev" title="Data Conventions" href="../conventions/data_conventions.html" />

    <!-- Generated with Sphinx 7.3.7 and Furo 2024.05.06 -->
        <title>Rasterization - gsplat documentation</title>
      <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=a746c00c" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo.css?v=387cc868" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/furo-extensions.css?v=36a5483c" />
    
    


<style>
  body {
    --color-code-background: #f8f8f8;
  --color-code-foreground: black;
  
  }
  @media not print {
    body[data-theme="dark"] {
      --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
    }
    @media (prefers-color-scheme: dark) {
      body:not([data-theme="light"]) {
        --color-code-background: #202020;
  --color-code-foreground: #d0d0d0;
  
      }
    }
  }
</style></head>
  <body>
    
    <script>
      document.body.dataset.theme = localStorage.getItem("theme") || "auto";
    </script>
    

<svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
  <symbol id="svg-toc" viewBox="0 0 24 24">
    <title>Contents</title>
    <svg stroke="currentColor" fill="currentColor" stroke-width="0" viewBox="0 0 1024 1024">
      <path d="M408 442h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8zm-8 204c0 4.4 3.6 8 8 8h480c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8H408c-4.4 0-8 3.6-8 8v56zm504-486H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zm0 632H120c-4.4 0-8 3.6-8 8v56c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-56c0-4.4-3.6-8-8-8zM115.4 518.9L271.7 642c5.8 4.6 14.4.5 14.4-6.9V388.9c0-7.4-8.5-11.5-14.4-6.9L115.4 505.1a8.74 8.74 0 0 0 0 13.8z"/>
    </svg>
  </symbol>
  <symbol id="svg-menu" viewBox="0 0 24 24">
    <title>Menu</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-menu">
      <line x1="3" y1="12" x2="21" y2="12"></line>
      <line x1="3" y1="6" x2="21" y2="6"></line>
      <line x1="3" y1="18" x2="21" y2="18"></line>
    </svg>
  </symbol>
  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
    <title>Expand</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather-chevron-right">
      <polyline points="9 18 15 12 9 6"></polyline>
    </svg>
  </symbol>
  <symbol id="svg-sun" viewBox="0 0 24 24">
    <title>Light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="feather-sun">
      <circle cx="12" cy="12" r="5"></circle>
      <line x1="12" y1="1" x2="12" y2="3"></line>
      <line x1="12" y1="21" x2="12" y2="23"></line>
      <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
      <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
      <line x1="1" y1="12" x2="3" y2="12"></line>
      <line x1="21" y1="12" x2="23" y2="12"></line>
      <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
      <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
    </svg>
  </symbol>
  <symbol id="svg-moon" viewBox="0 0 24 24">
    <title>Dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-moon">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446a9 9 0 1 1 -8.313 -12.454z" />
    </svg>
  </symbol>
  <symbol id="svg-sun-half" viewBox="0 0 24 24">
    <title>Auto light/dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-shadow">
      <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
      <circle cx="12" cy="12" r="9" />
      <path d="M13 12h5" />
      <path d="M13 15h4" />
      <path d="M13 18h1" />
      <path d="M13 9h4" />
      <path d="M13 6h1" />
    </svg>
  </symbol>
  <symbol id="svg-sun-with-moon" viewBox="0 0 24 24">
    <title>Auto light/dark, in light mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path style="opacity: 50%" d="M 5.411 14.504 C 5.471 14.504 5.532 14.504 5.591 14.504 C 3.639 16.319 4.383 19.569 6.931 20.352 C 7.693 20.586 8.512 20.551 9.25 20.252 C 8.023 23.207 4.056 23.725 2.11 21.184 C 0.166 18.642 1.702 14.949 4.874 14.536 C 5.051 14.512 5.231 14.5 5.411 14.5 L 5.411 14.504 Z"/>
      <line x1="14.5" y1="3.25" x2="14.5" y2="1.25"/>
      <line x1="14.5" y1="15.85" x2="14.5" y2="17.85"/>
      <line x1="10.044" y1="5.094" x2="8.63" y2="3.68"/>
      <line x1="19" y1="14.05" x2="20.414" y2="15.464"/>
      <line x1="8.2" y1="9.55" x2="6.2" y2="9.55"/>
      <line x1="20.8" y1="9.55" x2="22.8" y2="9.55"/>
      <line x1="10.044" y1="14.006" x2="8.63" y2="15.42"/>
      <line x1="19" y1="5.05" x2="20.414" y2="3.636"/>
      <circle cx="14.5" cy="9.55" r="3.6"/>
    </svg>
  </symbol>
  <symbol id="svg-moon-with-sun" viewBox="0 0 24 24">
    <title>Auto light/dark, in dark mode</title>
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round"
      class="icon-custom-derived-from-feather-sun-and-tabler-moon">
      <path d="M 8.282 7.007 C 8.385 7.007 8.494 7.007 8.595 7.007 C 5.18 10.184 6.481 15.869 10.942 17.24 C 12.275 17.648 13.706 17.589 15 17.066 C 12.851 22.236 5.91 23.143 2.505 18.696 C -0.897 14.249 1.791 7.786 7.342 7.063 C 7.652 7.021 7.965 7 8.282 7 L 8.282 7.007 Z"/>
      <line style="opacity: 50%" x1="18" y1="3.705" x2="18" y2="2.5"/>
      <line style="opacity: 50%" x1="18" y1="11.295" x2="18" y2="12.5"/>
      <line style="opacity: 50%" x1="15.316" y1="4.816" x2="14.464" y2="3.964"/>
      <line style="opacity: 50%" x1="20.711" y1="10.212" x2="21.563" y2="11.063"/>
      <line style="opacity: 50%" x1="14.205" y1="7.5" x2="13.001" y2="7.5"/>
      <line style="opacity: 50%" x1="21.795" y1="7.5" x2="23" y2="7.5"/>
      <line style="opacity: 50%" x1="15.316" y1="10.184" x2="14.464" y2="11.036"/>
      <line style="opacity: 50%" x1="20.711" y1="4.789" x2="21.563" y2="3.937"/>
      <circle style="opacity: 50%" cx="18" cy="7.5" r="2.169"/>
    </svg>
  </symbol>
  <symbol id="svg-pencil" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-pencil-code">
      <path d="M4 20h4l10.5 -10.5a2.828 2.828 0 1 0 -4 -4l-10.5 10.5v4" />
      <path d="M13.5 6.5l4 4" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" /
    </svg>
  </symbol>
  <symbol id="svg-eye" viewBox="0 0 24 24">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"
      stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="icon-tabler-eye-code">
      <path stroke="none" d="M0 0h24v24H0z" fill="none" />
      <path d="M10 12a2 2 0 1 0 4 0a2 2 0 0 0 -4 0" />
      <path
        d="M11.11 17.958c-3.209 -.307 -5.91 -2.293 -8.11 -5.958c2.4 -4 5.4 -6 9 -6c3.6 0 6.6 2 9 6c-.21 .352 -.427 .688 -.647 1.008" />
      <path d="M20 21l2 -2l-2 -2" />
      <path d="M17 17l-2 2l2 2" />
    </svg>
  </symbol>
</svg>

<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation">
<input type="checkbox" class="sidebar-toggle" name="__toc" id="__toc">
<label class="overlay sidebar-overlay" for="__navigation">
  <div class="visually-hidden">Hide navigation sidebar</div>
</label>
<label class="overlay toc-overlay" for="__toc">
  <div class="visually-hidden">Hide table of contents sidebar</div>
</label>

<a class="skip-to-content muted-link" href="#furo-main-content">Skip to content</a>



<div class="page">
  <header class="mobile-header">
    <div class="header-left">
      <label class="nav-overlay-icon" for="__navigation">
        <div class="visually-hidden">Toggle site navigation sidebar</div>
        <i class="icon"><svg><use href="#svg-menu"></use></svg></i>
      </label>
    </div>
    <div class="header-center">
      <a href="../index.html"><div class="brand">gsplat  documentation</div></a>
    </div>
    <div class="header-right">
      <div class="theme-toggle-container theme-toggle-header">
        <button class="theme-toggle">
          <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
          <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
          <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
          <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
          <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
        </button>
      </div>
      <label class="toc-overlay-icon toc-header-icon" for="__toc">
        <div class="visually-hidden">Toggle table of contents sidebar</div>
        <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
      </label>
    </div>
  </header>
  <aside class="sidebar-drawer">
    <div class="sidebar-container">
      
      <div class="sidebar-sticky"><a class="sidebar-brand" href="../index.html">
     
    <span class="sidebar-brand-text">gsplat  documentation</span> 
</a>

<!-- Dropdown for different versions of the docs. Slightly hacky. -->
<div style="padding: 0 1em;">
    <script>
      var DocsVersionsPopulated = false;

      async function getVersionList() {
        // This index.txt file is written by the docs.yml GitHub action.
        // https://github.com/nerfstudio-project/gsplat/blob/main/.github/workflows/doc.yml
        const response = await fetch(
          "https://docs.gsplat.studio/versions/index.txt",
          { cache: "no-cache" }
        );
        return await response.text();
      }
      async function DocsPopulateVersionDropDown () {
        // Load the version list lazily...
        if (DocsVersionsPopulated) {
          return;
        }
        DocsVersionsPopulated = true;

        console.log("Populating docs version list!")
        const versions = (await getVersionList()).trim().split("\n").reverse();
        console.log(versions);
        let htmlString = "<ul style='margin: 0.5rem 0 0 0'>";
        htmlString += `<li><a href="https://docs.gsplat.studio/main">main</a></li>`;
        for (let version of versions) {
          htmlString += `<li><a href="https://docs.gsplat.studio/versions/${version}">${version}</a></li>`;
        }

        htmlString += "</ul>";
        document.getElementById("version-dropdown").innerHTML = htmlString;
      }
    </script>
    <details
        style="padding: 0.5rem; background: var(--color-background-primary); border-radius: 0.5rem; border: 1px solid var(--color-sidebar-background-border);"
        ontoggle="DocsPopulateVersionDropDown()"
    >
    <summary style="cursor: pointer;"><strong>Version:</strong> <em>main</em></summary>
      <div id="version-dropdown"></div>
    </details>
    <!-- End dropdown -->
</div>

<div style="text-align: left; padding: 1em">
    <script async defer src="https://buttons.github.io/buttons.js"></script>
    <a class="github-button" href="https://github.com/nerfstudio-project/gsplat"
        data-color-scheme="no-preference: light; light: light; dark: light;" data-size="large" data-show-count="true"
        aria-label="Download buttons/github-buttons on GitHub">
        Github
    </a>
</div><form class="sidebar-search-container" method="get" action="../search.html" role="search">
  <input class="sidebar-search" placeholder="Search" name="q" aria-label="Search">
  <input type="hidden" name="check_keywords" value="yes">
  <input type="hidden" name="area" value="default">
</form>
<div id="searchbox"></div><div class="sidebar-scroll"><div class="sidebar-tree">
  <p class="caption" role="heading"><span class="caption-text">Examples</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../examples/colmap.html">Fit a COLMAP Capture</a></li>
<li class="toctree-l1"><a class="reference internal" href="../examples/image.html">Fit a Single Image</a></li>
<li class="toctree-l1"><a class="reference internal" href="../examples/large_scale.html">Render a Large Scene</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Conventions</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../conventions/data_conventions.html">Data Conventions</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Python API</span></p>
<ul class="current">
<li class="toctree-l1 current current-page"><a class="current reference internal" href="#">Rasterization</a></li>
<li class="toctree-l1"><a class="reference internal" href="utils.html">Utils</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Tests</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../tests/eval.html">Evaluation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tests/profile.html">Profiling</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tests/tests.html">Tests</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Migration</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../migration/migration_inria.html">Migrate from diff-gaussian-rasterization</a></li>
<li class="toctree-l1"><a class="reference internal" href="../migration/migration_legacy.html">Migrate from gsplat v0.1.11</a></li>
</ul>

</div>
</div>

      </div>
      
    </div>
  </aside>
  <div class="main">
    <div class="content">
      <div class="article-container">
        <a href="#" class="back-to-top muted-link">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
          </svg>
          <span>Back to top</span>
        </a>
        <div class="content-icon-container">
          <div class="view-this-page">
  <a class="muted-link" href="../_sources/apis/rasterization.rst.txt" title="View this page">
    <svg><use href="#svg-eye"></use></svg>
    <span class="visually-hidden">View this page</span>
  </a>
</div>
<div class="theme-toggle-container theme-toggle-content">
            <button class="theme-toggle">
              <div class="visually-hidden">Toggle Light / Dark / Auto color theme</div>
              <svg class="theme-icon-when-auto-light"><use href="#svg-sun-with-moon"></use></svg>
              <svg class="theme-icon-when-auto-dark"><use href="#svg-moon-with-sun"></use></svg>
              <svg class="theme-icon-when-dark"><use href="#svg-moon"></use></svg>
              <svg class="theme-icon-when-light"><use href="#svg-sun"></use></svg>
            </button>
          </div>
          <label class="toc-overlay-icon toc-content-icon" for="__toc">
            <div class="visually-hidden">Toggle table of contents sidebar</div>
            <i class="icon"><svg><use href="#svg-toc"></use></svg></i>
          </label>
        </div>
        <article role="main" id="furo-main-content">
          <section id="rasterization">
<h1>Rasterization<a class="headerlink" href="#rasterization" title="Link to this heading">¶</a></h1>
<p>Given a set of 3D gaussians parametrized by means <span class="math notranslate nohighlight">\(\mu \in \mathbb{R}^3\)</span>, covariances
<span class="math notranslate nohighlight">\(\Sigma \in \mathbb{R}^{3 \times 3}\)</span>, colors <span class="math notranslate nohighlight">\(c\)</span>, and opacities <span class="math notranslate nohighlight">\(o\)</span>, we first
compute their projected means <span class="math notranslate nohighlight">\(\mu' \in \mathbb{R}^2\)</span> and covariances
<span class="math notranslate nohighlight">\(\Sigma' \in \mathbb{R}^{2 \times 2}\)</span> on the image planes. Then we sort each gaussian such
that all gaussians within the bounds of a tile are grouped and sorted by increasing
depth <span class="math notranslate nohighlight">\(z\)</span>, and then render each pixel within the tile with alpha-compositing.</p>
<p>Note, the 3D covariances are reparametrized with a scaling matrix
<span class="math notranslate nohighlight">\(S = \text{diag}(\mathbf{s}) \in \mathbb{R}^{3 \times 3}\)</span> represented by a
scale vector <span class="math notranslate nohighlight">\(s \in \mathbb{R}^3\)</span>, and a rotation matrix
<span class="math notranslate nohighlight">\(R \in \mathbb{R}^{3 \times 3}\)</span> represented by a rotation
quaternion <span class="math notranslate nohighlight">\(q \in \mathcal{R}^4\)</span>:</p>
<div class="math-wrapper docutils container">
<div class="math notranslate nohighlight">
\[\Sigma = RSS^{T}R^{T}\]</div>
</div>
<p>The projection of 3D Gaussians is approximated with the Jacobian of the perspective
projection equation:</p>
<div class="math-wrapper docutils container">
<div class="math notranslate nohighlight">
\[\begin{split}J = \begin{bmatrix}
    f_{x}/z &amp; 0 &amp; -f_{x} t_{x}/z^{2} \\
    0 &amp; f_{y}/z &amp; -f_{y} t_{y}/z^{2} \\
    0 &amp; 0 &amp; 0
\end{bmatrix}\end{split}\]</div>
</div>
<div class="math-wrapper docutils container">
<div class="math notranslate nohighlight">
\[\Sigma' = J W \Sigma W^{T} J^{T}\]</div>
</div>
<p>Where <span class="math notranslate nohighlight">\([W | t]\)</span> is the world-to-camera transformation matrix, and <span class="math notranslate nohighlight">\(f_{x}, f_{y}\)</span>
are the focal lengths of the camera.</p>
<dl class="py function">
<dt class="sig sig-object py" id="gsplat.rasterization">
<span class="sig-name descname"><span class="pre">rasterization</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">means</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Tensor</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">quats</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Tensor</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">scales</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Tensor</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">opacities</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Tensor</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">colors</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Tensor</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">viewmats</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Tensor</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">Ks</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Tensor</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">width</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.12)"><span class="pre">int</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">height</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.12)"><span class="pre">int</span></a></span></em>, <em class="sig-param"><span class="n"><span class="pre">near_plane</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.12)"><span class="pre">float</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">0.01</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">far_plane</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.12)"><span class="pre">float</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">10000000000.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">radius_clip</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.12)"><span class="pre">float</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">0.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">eps2d</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.12)"><span class="pre">float</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">0.3</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sh_degree</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.12)"><span class="pre">int</span></a><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.12)"><span class="pre">None</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">packed</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.12)"><span class="pre">bool</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">True</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tile_size</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.12)"><span class="pre">int</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">16</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">backgrounds</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">Tensor</span><span class="w"> </span><span class="p"><span class="pre">|</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/constants.html#None" title="(in Python v3.12)"><span class="pre">None</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">render_mode</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">typing_extensions.Literal[RGB,</span> <span class="pre">D,</span> <span class="pre">ED,</span> <span class="pre">RGB</span> <span class="pre">+</span> <span class="pre">D,</span> <span class="pre">RGB</span> <span class="pre">+</span> <span class="pre">ED]</span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'RGB'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">sparse_grad</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.12)"><span class="pre">bool</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">absgrad</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><a class="reference external" href="https://docs.python.org/3/library/functions.html#bool" title="(in Python v3.12)"><span class="pre">bool</span></a></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">rasterize_mode</span></span><span class="p"><span class="pre">:</span></span><span class="w"> </span><span class="n"><span class="pre">typing_extensions.Literal</span><span class="p"><span class="pre">[</span></span><span class="pre">classic</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">antialiased</span><span class="p"><span class="pre">]</span></span></span><span class="w"> </span><span class="o"><span class="pre">=</span></span><span class="w"> </span><span class="default_value"><span class="pre">'classic'</span></span></em><span class="sig-paren">)</span> <span class="sig-return"><span class="sig-return-icon">&#x2192;</span> <span class="sig-return-typehint"><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Tuple" title="(in Python v3.12)"><span class="pre">Tuple</span></a><span class="p"><span class="pre">[</span></span><span class="pre">Tensor</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><span class="pre">Tensor</span><span class="p"><span class="pre">,</span></span><span class="w"> </span><a class="reference external" href="https://docs.python.org/3/library/typing.html#typing.Dict" title="(in Python v3.12)"><span class="pre">Dict</span></a><span class="p"><span class="pre">]</span></span></span></span><a class="headerlink" href="#gsplat.rasterization" title="Link to this definition">¶</a></dt>
<dd><p>Rasterize a set of 3D Gaussians (N) to a batch of image planes (C).</p>
<p>This function provides a handful features for 3D Gaussian rasterization, which
we detail in the following notes. A complete profiling of the these features
can be found in the <a class="reference internal" href="../tests/profile.html#profiling"><span class="std std-ref">Profiling</span></a> page.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><strong>Batch Rasterization</strong>: This function allows for rasterizing a set of 3D Gaussians
to a batch of images in one go, by simplly providing the batched <cite>viewmats</cite> and <cite>Ks</cite>.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><strong>Support N-D Features</strong>: If <cite>sh_degree</cite> is None,
the <cite>colors</cite> is expected to be with shape [N, D], in which D is the channel
of the features to be rendered, up to 32 at the moment. If
<cite>sh_degree</cite> is set, the <cite>colors</cite> is expected to be the SH coefficients with
shape [N, K, 3], where K is the number of SH bases. In this case, it is expected
that <span class="math notranslate nohighlight">\((\textit{sh_degree} + 1) ^ 2 \leq K\)</span>, where <cite>sh_degree</cite> controls the
activated bases in the SH coefficients.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><strong>Depth Rendering</strong>: This function supports colors or/and depths via <cite>render_mode</cite>.
The supported modes are “RGB”, “D”, “ED”, “RGB+D”, and “RGB+ED”. “RGB” renders the
colored image that respects the <cite>colors</cite> argument. “D” renders the accumulated z-depth
<span class="math notranslate nohighlight">\(\sum_i w_i z_i\)</span>. “ED” renders the expected z-depth
<span class="math notranslate nohighlight">\(\frac{\sum_i w_i z_i}{\sum_i w_i}\)</span>. “RGB+D” and “RGB+ED” render both
the colored image and the depth, in which the depth is the last channel of the output.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><strong>Memory-Speed Trade-off</strong>: The <cite>packed</cite> argument provides a trade-off between
memory footprint and runtime. If <cite>packed</cite> is True, the intermediate results are
packed into sparse tensors, which is more memory efficient but might be slightly
slower. This is especially helpful when the scene is large and each camera sees only
a small portion of the scene. If <cite>packed</cite> is False, the intermediate results are
with shape [C, N, …], which is faster but might consume more memory.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><strong>Sparse Gradients</strong>: If <cite>sparse_grad</cite> is True, the gradients for {means, quats, scales}
will be stored in a <a class="reference external" href="https://pytorch.org/docs/stable/generated/torch.sparse_coo_tensor.html">COO sparse layout</a>.
This can be helpful for saving memory
for training when the scene is large and each iteration only activates a small portion
of the Gaussians. Usually a sparse optimizer is required to work with sparse gradients,
such as <a class="reference external" href="https://pytorch.org/docs/stable/generated/torch.optim.SparseAdam.html#sparseadam">torch.optim.SparseAdam</a>.
This argument is only effective when <cite>packed</cite> is True.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><strong>Speed-up for Large Scenes</strong>: The <cite>radius_clip</cite> argument is extremely helpful for
speeding up large scale scenes or scenes with large depth of fields. Gaussians with
2D radius smaller or equal than this value (in pixel unit) will be skipped during rasterization.
This will skip all the far-away Gaussians that are too small to be seen in the image.
But be warned that if there are close-up Gaussians that are also below this threshold, they will
also get skipped (which is rarely happened in practice). This is by default disabled by setting
<cite>radius_clip</cite> to 0.0.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><strong>Antialiased Rendering</strong>: If <cite>rasterize_mode</cite> is “antialiased”, the function will
apply a view-dependent compensation factor
<span class="math notranslate nohighlight">\(\rho=\sqrt{\frac{Det(\Sigma)}{Det(\Sigma+ \epsilon I)}}\)</span> to Gaussian
opacities, where <span class="math notranslate nohighlight">\(\Sigma\)</span> is the projected 2D covariance matrix and <span class="math notranslate nohighlight">\(\epsilon\)</span>
is the <cite>eps2d</cite>. This will make the rendered image more antialiased, as proposed in
the paper <a class="reference external" href="https://arxiv.org/pdf/2311.16493">Mip-Splatting: Alias-free 3D Gaussian Splatting</a>.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><strong>AbsGrad</strong>: If <cite>absgrad</cite> is True, the absolute gradients of the projected
2D means will be computed during the backward pass, which could be accessed by
<cite>meta[“means2d”].absgrad</cite>. This is an implementation of the paper
<a class="reference external" href="https://arxiv.org/abs/2404.10484">AbsGS: Recovering Fine Details for 3D Gaussian Splatting</a>,
which is shown to be more effective for splitting Gaussians during training.</p>
</div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>This function is currently not differentiable w.r.t. the camera intrinsics <cite>Ks</cite>.</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>means</strong> – The 3D centers of the Gaussians. [N, 3]</p></li>
<li><p><strong>quats</strong> – The quaternions of the Gaussians. It’s not required to be normalized. [N, 4]</p></li>
<li><p><strong>scales</strong> – The scales of the Gaussians. [N, 3]</p></li>
<li><p><strong>opacities</strong> – The opacities of the Gaussians. [N]</p></li>
<li><p><strong>colors</strong> – The colors of the Gaussians. [N, D] or [N, K, 3] for SH coefficients.</p></li>
<li><p><strong>viewmats</strong> – The world-to-cam transformation of the cameras. [C, 4, 4]</p></li>
<li><p><strong>Ks</strong> – The camera intrinsics. [C, 3, 3]</p></li>
<li><p><strong>width</strong> – The width of the image.</p></li>
<li><p><strong>height</strong> – The height of the image.</p></li>
<li><p><strong>near_plane</strong> – The near plane for clipping. Default is 0.01.</p></li>
<li><p><strong>far_plane</strong> – The far plane for clipping. Default is 1e10.</p></li>
<li><p><strong>radius_clip</strong> – Gaussians with 2D radius smaller or equal than this value will be
skipped. This is extremely helpful for speeding up large scale scenes.
Default is 0.0.</p></li>
<li><p><strong>eps2d</strong> – An epsilon added to the egienvalues of projected 2D covariance matrices.
This will prevents the projected GS to be too small. For example eps2d=0.3
leads to minimal 3 pixel unit. Default is 0.3.</p></li>
<li><p><strong>sh_degree</strong> – The SH degree to use, which can be smaller than the total
number of bands. If set, the <cite>colors</cite> should be [N, K, 3] SH coefficients,
else the <cite>colors</cite> should [N, D] per-Gaussian color values. Default is None.</p></li>
<li><p><strong>packed</strong> – Whether to use packed mode which is more memory efficient but might or
might not be as fast. Default is True.</p></li>
<li><p><strong>tile_size</strong> – The size of the tiles for rasterization. Default is 16.
(Note: other values are not tested)</p></li>
<li><p><strong>backgrounds</strong> – The background colors. [C, D]. Default is None.</p></li>
<li><p><strong>render_mode</strong> – The rendering mode. Supported modes are “RGB”, “D”, “ED”, “RGB+D”,
and “RGB+ED”. “RGB” renders the colored image, “D” renders the accumulated depth, and
“ED” renders the expected depth. Default is “RGB”.</p></li>
<li><p><strong>sparse_grad</strong> – If true, the gradients for {means, quats, scales} will be stored in
a COO sparse layout. This can be helpful for saving memory. Default is False.</p></li>
<li><p><strong>absgrad</strong> – If true, the absolute gradients of the projected 2D means
will be computed during the backward pass, which could be accessed by
<cite>meta[“means2d”].absgrad</cite>. Default is False.</p></li>
<li><p><strong>rasterize_mode</strong> – The rasterization mode. Supported modes are “classic” and
“antialiased”. Default is “classic”.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p><p><strong>render_colors</strong>: The rendered colors. [C, height, width, X].
X depends on the <cite>render_mode</cite> and input <cite>colors</cite>. If <cite>render_mode</cite> is “RGB”,
X is D; if <cite>render_mode</cite> is “D” or “ED”, X is 1; if <cite>render_mode</cite> is “RGB+D” or
“RGB+ED”, X is D+1.</p>
<p><strong>render_alphas</strong>: The rendered alphas. [C, height, width, 1].</p>
<p><strong>meta</strong>: A dictionary of intermediate results of the rasterization.</p>
</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>A tuple</p>
</dd>
</dl>
<p>Examples:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="c1"># define Gaussians</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">means</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">randn</span><span class="p">((</span><span class="mi">100</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">quats</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">randn</span><span class="p">((</span><span class="mi">100</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span> <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">scales</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">rand</span><span class="p">((</span><span class="mi">100</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">colors</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">rand</span><span class="p">((</span><span class="mi">100</span><span class="p">,</span> <span class="mi">3</span><span class="p">),</span> <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">opacities</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">rand</span><span class="p">((</span><span class="mi">100</span><span class="p">,),</span> <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># define cameras</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">viewmats</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">)[</span><span class="kc">None</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Ks</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span>
<span class="gp">&gt;&gt;&gt; </span>   <span class="p">[</span><span class="mf">300.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">150.</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">300.</span><span class="p">,</span> <span class="mf">100.</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">1.</span><span class="p">]],</span> <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">)[</span><span class="kc">None</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">width</span><span class="p">,</span> <span class="n">height</span> <span class="o">=</span> <span class="mi">300</span><span class="p">,</span> <span class="mi">200</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># render</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">colors</span><span class="p">,</span> <span class="n">alphas</span><span class="p">,</span> <span class="n">meta</span> <span class="o">=</span> <span class="n">rasterization</span><span class="p">(</span>
<span class="gp">&gt;&gt;&gt; </span>   <span class="n">means</span><span class="p">,</span> <span class="n">quats</span><span class="p">,</span> <span class="n">scales</span><span class="p">,</span> <span class="n">opacities</span><span class="p">,</span> <span class="n">colors</span><span class="p">,</span> <span class="n">viewmats</span><span class="p">,</span> <span class="n">Ks</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span>
<span class="gp">&gt;&gt;&gt; </span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span> <span class="p">(</span><span class="n">colors</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">alphas</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
<span class="go">torch.Size([1, 200, 300, 3]) torch.Size([1, 200, 300, 1])</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span> <span class="p">(</span><span class="n">meta</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
<span class="go">dict_keys([&#39;camera_ids&#39;, &#39;gaussian_ids&#39;, &#39;radii&#39;, &#39;means2d&#39;, &#39;depths&#39;, &#39;conics&#39;,</span>
<span class="go">&#39;opacities&#39;, &#39;tile_width&#39;, &#39;tile_height&#39;, &#39;tiles_per_gauss&#39;, &#39;isect_ids&#39;,</span>
<span class="go">&#39;flatten_ids&#39;, &#39;isect_offsets&#39;, &#39;width&#39;, &#39;height&#39;, &#39;tile_size&#39;])</span>
</pre></div>
</div>
</dd></dl>

</section>

        </article>
      </div>
      <footer>
        
        <div class="related-pages">
          <a class="next-page" href="utils.html">
              <div class="page-info">
                <div class="context">
                  <span>Next</span>
                </div>
                <div class="title">Utils</div>
              </div>
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
            </a>
          <a class="prev-page" href="../conventions/data_conventions.html">
              <svg class="furo-related-icon"><use href="#svg-arrow-right"></use></svg>
              <div class="page-info">
                <div class="context">
                  <span>Previous</span>
                </div>
                
                <div class="title">Data Conventions</div>
                
              </div>
            </a>
        </div>
        <div class="bottom-of-page">
          <div class="left-details">
            <div class="copyright">
                Copyright &#169; 2023, nerfstudio team
            </div>
            Made with <a href="https://www.sphinx-doc.org/">Sphinx</a> and <a class="muted-link" href="https://pradyunsg.me">@pradyunsg</a>'s
            
            <a href="https://github.com/pradyunsg/furo">Furo</a>
            
          </div>
          <div class="right-details">
            
          </div>
        </div>
        
      </footer>
    </div>
    <aside class="toc-drawer">
      
      
      <div class="toc-sticky toc-scroll">
        <div class="toc-title-container">
          <span class="toc-title">
            On this page
          </span>
        </div>
        <div class="toc-tree-container">
          <div class="toc-tree">
            <ul>
<li><a class="reference internal" href="#">Rasterization</a><ul>
<li><a class="reference internal" href="#gsplat.rasterization"><code class="docutils literal notranslate"><span class="pre">rasterization()</span></code></a></li>
</ul>
</li>
</ul>

          </div>
        </div>
      </div>
      
      
    </aside>
  </div>
</div><script src="../_static/documentation_options.js?v=5929fcd5"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/scripts/furo.js?v=4e2eecee"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    </body>
</html>